<app-header></app-header>

<div class="detail-wrap" *ngIf="outing() as o">
  <header class="hdr">
    <h1>{{ o.title }}</h1>
    <div class="sub">{{ o.location }} • {{ o.start_date }} → {{ o.end_date }}</div>
  </header>

  <!-- was: *ngIf="members.length" -->
  <section class="members-section" *ngIf="owner || (members && members.length >= 0)">
    <div class="owner-block" *ngIf="owner">
      <h3 class="subhead">Owner</h3>
      <div class="member-card owner">
        <img [src]="owner.avatar_url || 'assets/default_pfp.jpg'" class="member-ava" alt="" />
        <div class="member-name">{{ owner.display_name || owner.name || owner.email }}</div>
      </div>
    </div>

    <div class="members-block">
      <h3 class="subhead">Members</h3>

      <ng-container *ngIf="members && members.length; else noMembers">
        <div class="member-card" *ngFor="let m of members">
          <img [src]="m.avatar_url || 'assets/default_pfp.jpg'" class="member-ava" alt="" />
          <div class="member-name">{{ m.display_name || m.name || m.email }}</div>
          <button *ngIf="isOwner" class="remove-btn" (click)="removeMember(m.email, $event)">
            Remove
          </button>
        </div>
      </ng-container>

      <ng-template #noMembers>
        <div class="member-empty">No members yet.</div>
      </ng-template>

      <h3 class="subhead">Set your preferences</h3>
      <button class="set-preferences" (click)="openPreferences()">Set Preferences</button>

      <h3 class="subhead">Group Preference Profile</h3>
      <button class="group-profile" (click)="openGroupProfile()">View Group Profile</button>
    </div>
  </section>

  <div class="layout">
    <section class="left">
      <nav class="tabs">
        <button [class.active]="tab() === 'food'" (click)="loadTab('food')">Food & drink</button>
        <button [class.active]="tab() === 'stay'" (click)="loadTab('stay')">Places to stay</button>
        <button [class.active]="tab() === 'do'" (click)="loadTab('do')">Things to do</button>
      </nav>

      <div class="cards">
        <article
          class="card"
          *ngFor="let p of items(); trackBy: trackById"
          [class.active]="selectedId() === p.id"
          (mouseenter)="hoverItem(p)"
          (mouseleave)="hoverItem(null)"
          (click)="openInMaps(p)"
        >
          <img
            *ngIf="p.photo"
            [src]="p.photo"
            alt=""
            class="thumb"
            loading="lazy"
            referrerpolicy="no-referrer"
          />
          <div class="card-body">
            <div class="card-title">{{ p.name }}</div>
            <div class="card-subtitle">{{ p.address }}</div>
            <div class="card-rating">★ {{ p.rating?.toFixed(1) }} {{ p.priceText }}</div>
          </div>
        </article>
      </div>
    </section>

    <!-- right: map (plain JS) -->
    <section class="right" *ngIf="isBrowser && showMap()">
      <div #mapEl class="map"></div>
    </section>
  </div>
</div>
